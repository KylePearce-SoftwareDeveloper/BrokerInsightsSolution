<html>
    <head>
        <title>
            BrokerInsightsChallange
        </title>
        <script src = "../js/vue.js"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div id = "app">
            <table border='1' width='80%' style='border-collapse: collapse;'>
                <tr>
                    <th>customer_name</th>
                    <th>Edit/Update</th>
                    <th>customer_address</th>
                    <th>Edit/Update</th>
                    <th>premium</th>
                    <th>Edit/Update</th>
                    <th>policy_type</th>
                    <th>Edit/Update</th>
                    <th>insurer_name</th>
                    <th>Edit/Update</th>
                </tr>
                <!-- ADD-->
                <tr>
                    <td><input type = "text" v-model = "customer_name"></td>
                    <td></td>
                    <td><input type = "text" v-model = "customer_address"></td>
                    <td></td>
                    <td><input type = "text" v-model = "premium"></td>
                    <td></td>
                    <td><input type = "text" v-model = "policy_type"></td>
                    <td></td>
                    <td><input type = "text" v-model = "insurer_name"></td>
                    <td></td>
                    <td><input type = "button" value = "Add" @click='addRecord();'></td>
                    <td></td>
                </tr>
                <!-- SHOW ALL-->
                <tr v-for="(row, index) in allData">
                    <td>{{ row.customer_name }}</td>
                    <td><input type = "text"  v-model = "edited_customer_name"></td>
                    <td>{{ row.customer_address }}</td>
                    <td><input type = "text"  v-model = "edited_customer_address"></td>
                    <td>{{ row.premium }}</td>
                    <td><input type = "text"  v-model = "edited_premium"></td>
                    <td>{{ row.policy_type }}</td>
                    <td><input type = "text"  v-model = "edited_policy_type"></td>
                    <td>{{ row.insurer_name }}</td>
                    <td><input type = "text"  v-model = "edited_insurer_name"></td>
                    <td>
                        <input type='button' value='Edit/Update' @click='updateRecord(index);'> <!-- &nbsp; -->
                        <!-- <input type='button' value='Delete' @click='deleteRecord(index, row.customer_name)'> -->
                    </td>
                </tr>
            </table>
        </div>

        <script>
            var app = new Vue({
                el:'#app',
                data:{
                    allData: '',
                    customer_name: '',
                    customer_address: '',
                    premium: '',
                    policy_type: '',
                    insurer_name: '',
                    edited_customer_name: '',
                    edited_customer_address: '',
                    edited_premium: '',
                    edited_policy_type: '',
                    edited_insurer_name: ''
                },
                methods:{
                    fetchAllData:function(){
                        axios.post('../php/index.php', {
                            action: 'fetchall'
                        }).then(function(response){
                            app.allData = response.data;
                        });
                    },
                    addRecord: function(){
                        if(app.customer_name != '' && app.customer_address != '' && app.premium != '' && app.policy_type != '' && app.insurer_name != ''){
                        axios.post('../php/index.php', {
                        action: 'addrecord',
                        customer_name: app.customer_name,
                        customer_address: app.customer_address,
                        premium: app.premium,
                        policy_type: app.policy_type,
                        insurer_name: app.insurer_name
                        }).then(function (response) {
                            app.fetchAllData();
                            app.customer_name = '';
                            app.customer_address = '';
                            app.premium = '';
                            app.policy_type = '';
                            app.insurer_name = '';
                        })
                    }
                    },
                    updateRecord: function(index){
                    var new_customer_name = app.edited_customer_name;
                    var new_customer_address = app.edited_customer_address;
                    var new_premium = app.edited_premium;
                    var new_policy_type = app.edited_policy_type;
                    var new_insurer_name = app.edited_insurer_name;
                    if(new_customer_name !='' && new_customer_address !='' && new_premium !='' && new_policy_type !='' && new_insurer_name !=''){
                        axios.post('../php/index.php', {
                            action: 'editrecord',
                            oldName: app.allData[index].customer_name,
                            new_customer_name: new_customer_name,
                            new_customer_address: new_customer_address,
                            new_premium: new_premium,
                            new_policy_type: new_policy_type,
                            new_insurer_name: new_insurer_name
                        }).then(function (response) {
                            app.fetchAllData();
                        })
                    }
                    }
                },
                created:function(){
                    this.fetchAllData();
                }
            })
        </script>
    </body>
</html>
